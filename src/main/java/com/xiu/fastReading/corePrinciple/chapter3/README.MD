# 第三章-大型网站核心架构要素

本章主要讲述了在架构设计时需要考虑的核心要素。一切的设计都需要进行如下5个方面的考虑：
性能，可用性，伸缩性，扩展性，安全性

软件架构定义：有关软件整体结构和组件的抽象描述，用于指导大型软件系统各方面的设计。

系统架构包括功能模块，非功能模块，他们之间相互关联，构成软件系统架构

上述的5个要素，是架构设计中需要平衡考虑的，也是衡量一个软件架构的优劣。


## 3.1性能

问题：性能差的网站，是用户无法忍受的，会造成用户流失。

方案：
	1.浏览器端，浏览器缓存，使用页面压缩，合理布局页面，减少cookie传输等手段改善
	2.CDN：将网站静态内容分发至离用户最近的网络服务商机房，使用户通过最短路径访问
	3.nginx等反向代理：缓存热点文件，加快请求访问速度，减轻应用服务器负载压力
	4.缓存：应用服务端使用服务器本地缓存，分布式缓存，通过缓存在内存中的热点数据处理用户请求，加快请求处理过程，减轻
	数据库负载压力
	5.异步：用户请求发送到消息队列，等待后续任务处理，当前请求直接返回响应给用户
	6.集群：多台应用服务器组成一个集群共同对外服务，提高整体处理能力，改善性能。
	7.代码：多线程，改善内存管理
	8.数据库：索引，缓存，sql优化，使用nosql
	
衡量性能的指标：
	1.响应时间
	2.TPS
	3.系统性能计数器
用处：1.确定系统设计是否达到目标
	 2. 用于监控进行报警，分析系统瓶颈，预测网站容量,保障系统可用
	 
由于网站需要长时间持续运行，因此还必须考虑保证高并发下的稳定运行。


## 3.2可用性

问题:
	对于大型网站，网站宕机，服务不可用是重大事故。因为服务器硬件是普通的商用服务器，这些服务器的设计目标本身不能
	保证高可用，很可能出现服务器硬件故障，尤其是上万台服务器，每天必然有一些服务器宕机。

网站架构设计前提是必然出现服务器宕机，高可用就是为了在服务器宕机时，服务仍然是可用的。

方案：
	1.冗余:应用部署在多台服务器上同时提高访问。数据存储在多台服务器相互备份。
	
	（1）.应用服务器：应用服务器通过负载均衡设备组成集群，同时对外提高服务，任何一台服务器宕机，自动将请求
	切换到其他服务器，实现高可用。前提是，应用服务器必须是无状态的，如不能保留请求会话信息，否则会话丢失，转到其他
	服务器也无法完成业务处理。
	
	（2）.存储服务器：需要对数据进行实时备份，服务器宕机时，需要将数据访问转移到可用服务器上，并进行数据恢复，保证
	有服务器宕机时数据依然可用。
	
	2.软件开发过程质量保证：
	通过发布验证，自动化测试，自动化发布，灰度发布等手段，减少将故障引入线上环境的可能，避免故障范围扩大。
	
衡量一个系统架构设计是否高可用，假设有一台或几台服务器宕机，系统整体是否可用。

## 3.3伸缩性

伸缩性包括应对并发请求问题可伸缩性以及应对数据存储问题的伸缩性。
具体手段是：不断向集群中加入服务器。

伸缩性的衡量标准是：
	1.是否可以用多台服务器构建集群
	2.是否容易向集群添加新服务器
	3.加入新服务器后是否可以提供和原来服务器无差别服务
	4.集群中容纳的总的服务器数量是否有限制
	
具体应用：

	1.应用服务器集群：只要服务器上不保存数据，所有服务器都是对等的,通过使用负载均衡设备可以向集群中不断加入服务器
	2.缓存服务器集群：加入新的服务器可能导致缓存路由失效，进而导致集群中大部分缓存数据都无法访问。虽然缓存数据可以
	通过数据库重新加载，但如果应用严重依赖缓存，可能导致整个网站崩溃。可通过改进缓存路由算法保证缓存数据的可访问性
	3.关系型数据库：虽然支持支持数据复制，主从热备等机制，但很难做到大规模集群可伸缩性。因此必须数据库之外实现，
	通过路由分区等手段将部署有多个数据库服务器组成一个集群
	4.NOSQL数据库产品，先天是为海量数据而生，因此其伸缩性较好

## 3.4扩展性

	该架构设计要素，主要关注网站功能需求。网站快速发展，功能不断扩展，如何设计网站架构使其能快速响应需求
化，是网站可扩展架构的主要目的。
	
衡量标准：

	1.网站在增加新业务产品时，是否可以实现对现有产品透明无影响，不需要任何改动或很少改动既有业务功能就可以上线新产品
	2.不同产品之间是否很少耦合，一个产品改动对其他产品无印象，其他产品和功能不需要受牵连进行改动
	
手段：事件驱动架构和分布式服务

	事件驱动架构：利用消息队列实现，将用户请求和其他业务事件构造成消息发布到消息队列，消息处理者作为消费者从消息队列中
	获取消息进行处理。这样可以透明增加消息生产者或消息消费者
	
	分布式服务：将业务和可复用服务分离开来，通过分布式服务框架调用。新增产品可以调可复用服务实现自身业务逻辑，而对现有产品
	没有任何影响。可复用服务升级变更时，也可通过提供多版本服务对应用实现透明升级，不需要强制应用同步变更。	
	
大型网站为了保持市场地位，还会吸引第三方开发者，调用网站服务，使用网站数据开发周边产品，扩展网站业务。手段是
提供开放平台接口。

## 3.5安全性

网站安全架构是保护网站不受恶意攻击和访问，保护网站重要数据不被窃取。

标准：
	
	针对现存和潜在各种攻击与窃密手段是否有可靠应对策略



	
	
	
	
