# 第四章 瞬时响应：网站的高性能架构

本章主要介绍了高性能架构的评价指标，以及相关的优化方法。

## 4.1网站性能测试

性能测试是性能优化的前提和基础，也是性能优化结果的检查和度量标准。
不同视角下的网站性能有不同的标准，也有不同的优化手段

###4.1.1不同视角下的网站性能

1.用户视角下的网站视角

是用户在浏览器上直观感受到的网站响应速度快和慢。包括：用户计算机和服务器通信时间，网站服务器处理时间，
用户计算机浏览器构造请求解析响应数据的时间。

![image](https://github.com/williamzhang11/fastReading/blob/master/src/main/java/com/xiu/fastReading/corePrinciple/image/4.1.jpg)

用户感受的延迟：

	1.计算机性能差异
	2.不同浏览器解析html速度差异
	3.不同网络运营商提供的宽带服务差异
这些差异远远很可能会远远大于网站服务器处理请求时间

优化手段（前端优化）：

	1.优化页面html样式
	2.利用浏览器并发和异步特性
	3.调整浏览器缓存策略
	4.使用CDN服务，反向代理等手段
	5.浏览器尽快显示用户感兴趣内容，尽可能近的获取页面内容

2. 开发人员视角
	
开发人员主要关注应用程序本身和相关子系统的性能，包括
	
	1.响应延迟
	2.系统吞吐量
	3.并发处理能力
	4.系统稳定性等技术指标
	
优化手段：

	1.缓存加速数据读取
	2.使用集群提高吞吐能力
	3.使用异步消息加快请求响应及实现削峰
	4.代码优化

3.运维人员视角

运维人员更关注：基础设施性能和资源利用率如：

	1.网络运营商带宽能力、
	2.服务器硬件配置
	3.数据中心网络架构
	4.服务器和网络带宽资源利用率

优化手段：

	1.建设优化骨干网
	2.使用高性价比定制服务器
	3.使用虚拟化技术优化资源利用
	

### 4.1.2性能测试指标


不同视角有不同的性能标准，不同的标准有不同的性能测试指标，从开发和测试人员视角，网站性能测试指标有
响应时间，并发数，吞吐量，性能计数器

1.响应时间：

指应用执行一个操作需要的时间，包括从发出请求开始到收到最后响应数据所需要的时间。直观反映系统的快慢。

![image](https://github.com/williamzhang11/fastReading/blob/master/src/main/java/com/xiu/fastReading/corePrinciple/image/4.1biao.JPG)

计算方法：

	1.测试程序通过模拟应用程序，记录收到响应和发出请求之间的时间差计算系统响应时间。但是记录和获取系统时间也需要一定时间
	，如果测试目标本身需要较少时间，则测试程序无法测试系统响应时间
	2.实践中，采用的方法是重复请求，如一个请求重复执行1万次，然后取平均数

2.并发数

指系统能够同时处理请求数目，对网站来说并发数指同时提交请求的用户数目。

	网站用户在线用户数：当前登录网站用户总数
	网站系统用户数：注册用户数
	网站系统用户数>用户在线用户数>网站并发用户数
	
计算方法:
	
	测试程序通过多线程模拟并发用户方法测试系统的并发处理能力，为了真实模拟用户行为，不是启动多线程然后不停的发送请求
	而是在2次请求之间加入一个随机等待时间，思考时间
	
3.吞吐量

单位时间内系统处理的请求数量，体现系统的整体处理能力。
单位: 请求数/秒，页面数/秒，访问人数/天，处理业务数/小时，TPS（每秒事务数）是吞吐量的一个常用量化指标
HPS(每秒HTTP请求数)，QPS(每秒查询数)

一般规律：

	系统并发数由小到大过程中，服务器系统资源消耗逐渐增大，系统吞吐量先是逐渐增加，达到一个极限后，随着并发数
	的增加反而下降，达到系统奔溃点后，系统资源耗尽，吞吐量为零。
	
	在这个过程中，响应时间先是保持小幅上升，到达吞吐量极限后，快速上升，达到奔溃点后，系统失去响应。
	
网站性能优化的目的是：改善用户体验的响应时间，提高系统吞吐量，最大限度利用服务器资源。

4.性能计数器

是描述服务器或操作系统性能的一些数据指标。

	systemload,
	对象与线程数，
	内存使用，
	cpu使用，
	磁盘与网络I/O等指标，
	
也是系统监控的重要参数,监控系统发现性能计数器超过阈值时,向运维和开发人员报警.

systemload系统负载,当前正在被CPU执行和等待被CPU执行







